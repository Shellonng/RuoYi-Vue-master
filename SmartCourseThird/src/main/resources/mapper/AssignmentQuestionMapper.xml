<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.exampl.smartcourse.mapper.smartpaper.AssignmentQuestionMapper">

    <insert id="batchInsert">
        INSERT INTO assignment_question (assignment_id, question_id, score, sequence, is_deleted)
        VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.assignmentId}, #{item.questionId}, #{item.score}, #{item.sequence}, 0)
        </foreach>
    </insert>

    <update id="deleteByAssignmentId">
        UPDATE assignment_question
        SET is_deleted = 1,
            delete_time = NOW()
        WHERE assignment_id = #{assignmentId}
          AND is_deleted = 0
    </update>

    <select id="selectQuestionIdsByAssignmentId" resultType="java.lang.Long">
        SELECT question_id
        FROM assignment_question
        WHERE assignment_id = #{assignmentId}
          AND is_deleted = 0
        ORDER BY sequence ASC, id ASC
    </select>

    <select id="countByAssignmentId" resultType="java.lang.Integer">
        SELECT COUNT(1)
        FROM assignment_question
        WHERE assignment_id = #{assignmentId}
          AND is_deleted = 0
    </select>
</mapper>
