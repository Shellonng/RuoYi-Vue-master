# 团队协作与Git工作流规范

## 一、Git 分支管理策略（Git Flow）

### 1.1 分支类型

```
assessment-expert/
├── main (或 master)           # 主分支，生产环境代码
├── develop                    # 开发分支，所有功能合并到这里
├── feature/*                  # 功能分支
│   ├── feature/grade-management
│   ├── feature/question-bank
│   ├── feature/ai-grading
│   └── feature/analysis
├── hotfix/*                   # 紧急修复分支
└── release/*                  # 发布分支
```

### 1.2 分支命名规范

**功能分支**：`feature/功能名称`
- `feature/grade-management` - 成绩管理
- `feature/question-bank` - 题库管理
- `feature/ai-grading` - 智能批改
- `feature/analysis` - 学情分析

**修复分支**：`hotfix/问题描述`
- `hotfix/fix-grade-calculation` - 修复成绩计算问题

**发布分支**：`release/版本号`
- `release/v1.0.0`

### 1.3 工作流程

#### 步骤1：初始化仓库（负责人操作）

```bash
# 创建远程仓库后，初始化本地仓库
git clone https://github.com/your-team/assessment-expert.git
cd assessment-expert

# 创建并推送develop分支
git checkout -b develop
git push -u origin develop
```

#### 步骤2：团队成员克隆仓库

```bash
# 克隆仓库
git clone https://github.com/your-team/assessment-expert.git
cd assessment-expert

# 查看所有分支
git branch -a

# 切换到develop分支
git checkout develop
```

#### 步骤3：开发新功能

```bash
# 从develop创建功能分支
git checkout develop
git pull origin develop
git checkout -b feature/grade-management

# 开发过程中定期提交
git add .
git commit -m "feat: 实现成绩CRUD接口"

# 推送到远程仓库
git push -u origin feature/grade-management
```

#### 步骤4：合并功能分支

```bash
# 功能开发完成后，切换到develop
git checkout develop
git pull origin develop

# 合并功能分支
git merge feature/grade-management

# 解决冲突（如果有）
# 编辑冲突文件，然后
git add .
git commit -m "merge: 合并成绩管理功能"

# 推送到远程
git push origin develop

# 删除功能分支（可选）
git branch -d feature/grade-management
git push origin --delete feature/grade-management
```

#### 步骤5：发布到生产环境

```bash
# 从develop创建发布分支
git checkout develop
git checkout -b release/v1.0.0

# 进行最后的测试和修复
# 测试通过后，合并到main
git checkout main
git merge release/v1.0.0
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin main --tags

# 同时合并回develop
git checkout develop
git merge release/v1.0.0
git push origin develop
```

## 二、Commit 消息规范（Angular规范）

### 2.1 格式

```
<type>(<scope>): <subject>

<body>

<footer>
```

### 2.2 Type 类型

- `feat`: 新功能（feature）
- `fix`: 修复bug
- `docs`: 文档修改
- `style`: 格式调整（不影响代码运行）
- `refactor`: 重构（既不是新功能，也不是修复bug）
- `perf`: 性能优化
- `test`: 增加测试
- `chore`: 构建过程或辅助工具的变动
- `build`: 构建系统或外部依赖的变动
- `ci`: CI配置文件的变动

### 2.3 示例

```bash
# 新功能
git commit -m "feat(grade): 添加成绩批量导入功能"

# 修复bug
git commit -m "fix(analysis): 修复知识点掌握度计算错误"

# 文档
git commit -m "docs(readme): 更新API文档"

# 重构
git commit -m "refactor(service): 优化成绩查询逻辑"

# 性能优化
git commit -m "perf(mapper): 优化数据库查询，添加索引"
```

## 三、代码提交前检查清单

### 3.1 提交前必做

- [ ] 代码编译通过，无错误
- [ ] 运行相关单元测试，测试通过
- [ ] 代码格式化（IDEA快捷键：Ctrl+Alt+L）
- [ ] 删除无用的注释和调试代码
- [ ] 检查是否有敏感信息（密码、API Key）
- [ ] 更新相关文档（如果需要）

### 3.2 提交命令

```bash
# 查看修改的文件
git status

# 添加文件（推荐逐个添加）
git add src/main/java/com/assessment/controller/GradeController.java
git add src/main/java/com/assessment/service/impl/GradeServiceImpl.java

# 或添加所有修改
git add .

# 提交（写清楚commit message）
git commit -m "feat(grade): 实现成绩CRUD接口"

# 推送到远程
git push origin feature/grade-management
```

## 四、代码审查（Code Review）

### 4.1 什么时候需要Code Review

- 功能分支合并到develop前
- 重要功能实现后
- 发现代码质量问题时

### 4.2 Code Review检查点

**功能性**：
- [ ] 功能是否正确实现
- [ ] 是否有遗漏的边界条件
- [ ] 错误处理是否完善

**代码质量**：
- [ ] 代码是否易读
- [ ] 命名是否规范
- [ ] 是否有重复代码
- [ ] 是否遵循设计模式

**性能**：
- [ ] 数据库查询是否优化
- [ ] 是否有N+1查询问题
- [ ] 是否有内存泄漏风险

**安全**：
- [ ] 是否有SQL注入风险
- [ ] 是否有XSS风险
- [ ] 敏感数据是否加密

### 4.3 使用Pull Request（推荐）

```bash
# 1. 推送功能分支到远程
git push origin feature/grade-management

# 2. 在GitHub/GitLab上创建Pull Request
# 3. 邀请团队成员Review
# 4. 根据反馈修改代码
# 5. 审核通过后合并
```

## 五、冲突解决

### 5.1 避免冲突的最佳实践

1. **频繁同步develop分支**
   ```bash
   # 每天开始工作前
   git checkout develop
   git pull origin develop
   git checkout feature/your-feature
   git merge develop
   ```

2. **小步提交**：功能拆分成小任务，频繁提交

3. **团队分工明确**：避免多人同时修改同一文件

### 5.2 解决冲突步骤

```bash
# 1. 更新develop
git checkout develop
git pull origin develop

# 2. 合并到功能分支
git checkout feature/your-feature
git merge develop

# 3. 如果有冲突，Git会提示
# 打开冲突文件，你会看到：
<<<<<<< HEAD
你的代码
=======
别人的代码
>>>>>>> develop

# 4. 手动解决冲突，保留正确的代码

# 5. 标记为已解决
git add <冲突文件>
git commit -m "merge: 解决与develop的冲突"

# 6. 推送
git push origin feature/your-feature
```

## 六、团队协作工具推荐

### 6.1 项目管理

- **Trello** / **Notion** / **飞书文档**：任务看板
- **石墨文档** / **腾讯文档**：共享文档

### 6.2 接口管理

- **Apifox** / **Postman**：接口测试与Mock
- **Swagger**：自动生成API文档

### 6.3 代码托管

- **GitHub** / **Gitee** / **GitLab**

### 6.4 沟通工具

- **微信群** / **钉钉** / **Slack**

## 七、每日协作流程

### 7.1 早上（10:00站会，15分钟）

**站会三问**：
1. 昨天完成了什么？
2. 今天计划做什么？
3. 遇到什么困难？

**同步事项**：
- 接口变更通知
- 数据库变更通知
- 依赖关系提醒

### 7.2 开发中

```bash
# 开始工作前，同步最新代码
git checkout develop
git pull origin develop
git checkout feature/your-feature
git merge develop

# 开发过程中，定期提交（至少每2小时一次）
git add .
git commit -m "feat(xxx): 完成xxx功能的一部分"
git push origin feature/your-feature
```

### 7.3 晚上（代码合并，建议18:00前）

```bash
# 1. 确保你的代码可运行
mvn clean install

# 2. 提交并推送
git add .
git commit -m "feat(grade): 完成成绩管理的XX功能"
git push origin feature/your-feature

# 3. 如果功能完成，创建PR或合并到develop
# （由负责人或经过Code Review后操作）
```

## 八、紧急情况处理

### 8.1 误提交敏感信息

```bash
# 撤销最后一次提交（保留修改）
git reset --soft HEAD~1

# 删除敏感信息后重新提交
git add .
git commit -m "fix: 移除敏感信息"
```

### 8.2 提交到错误的分支

```bash
# 撤销提交（不保留修改）
git reset --hard HEAD~1

# 切换到正确分支
git checkout correct-branch

# 重新提交
```

### 8.3 需要回滚代码

```bash
# 查看提交历史
git log

# 回滚到指定版本
git reset --hard <commit-hash>

# 强制推送（谨慎使用！）
git push -f origin feature/your-feature
```

## 九、.gitignore 配置

创建 `.gitignore` 文件，避免提交不必要的文件：

```gitignore
# IDEA
.idea/
*.iml
*.iws
*.ipr
out/

# Eclipse
.settings/
.classpath
.project

# Maven
target/
pom.xml.tag
pom.xml.releaseBackup
pom.xml.versionsBackup

# Gradle
.gradle/
build/

# 日志
logs/
*.log

# 临时文件
*.tmp
*.bak
*.swp
*~

# 系统文件
.DS_Store
Thumbs.db

# 应用配置（包含敏感信息）
application-prod.yml
application-local.yml

# 上传文件
uploads/

# 编译文件
*.class
*.jar
*.war
```

## 十、常用Git命令速查

```bash
# 克隆仓库
git clone <url>

# 查看状态
git status

# 查看分支
git branch
git branch -a  # 查看所有分支（包括远程）

# 创建并切换分支
git checkout -b <branch-name>

# 切换分支
git checkout <branch-name>

# 拉取远程更新
git pull origin <branch-name>

# 添加文件
git add <file>
git add .  # 添加所有修改

# 提交
git commit -m "message"

# 推送
git push origin <branch-name>

# 合并分支
git merge <branch-name>

# 查看提交历史
git log
git log --oneline  # 简洁模式

# 查看差异
git diff
git diff <file>

# 撤销修改
git checkout -- <file>

# 暂存修改
git stash
git stash pop  # 恢复暂存

# 删除分支
git branch -d <branch-name>  # 本地
git push origin --delete <branch-name>  # 远程
```

## 推荐
```
assessment-expert/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/
│   │   │       └── assessment/
│   │   │           ├── AssessmentApplication.java          # 启动类
│   │   │           │
│   │   │           ├── config/                             # 配置类
│   │   │           │   ├── SwaggerConfig.java             # API文档配置
│   │   │           │   ├── SecurityConfig.java            # 安全配置
│   │   │           │   ├── CorsConfig.java                # 跨域配置
│   │   │           │   ├── MyBatisPlusConfig.java         # 数据库配置
│   │   │           │   └── AIConfig.java                  # LLM配置
│   │   │           │
│   │   │           ├── controller/                         # 控制层（接口）
│   │   │           │   ├── GradeController.java           # 成绩管理
│   │   │           │   ├── QuestionController.java        # 题库管理
│   │   │           │   ├── ExamController.java            # 考试管理
│   │   │           │   ├── AnalysisController.java        # 学情分析
│   │   │           │   └── AIGradingController.java       # 智能批改
│   │   │           │
│   │   │           ├── service/                            # 业务逻辑层
│   │   │           │   ├── IGradeService.java             # 接口
│   │   │           │   ├── IQuestionService.java
│   │   │           │   ├── IExamService.java
│   │   │           │   ├── IAnalysisService.java
│   │   │           │   ├── IAIGradingService.java
│   │   │           │   └── impl/                          # 实现类
│   │   │           │       ├── GradeServiceImpl.java
│   │   │           │       ├── QuestionServiceImpl.java
│   │   │           │       ├── ExamServiceImpl.java
│   │   │           │       ├── AnalysisServiceImpl.java
│   │   │           │       └── AIGradingServiceImpl.java
│   │   │           │
│   │   │           ├── mapper/                             # 数据访问层（MyBatis）
│   │   │           │   ├── GradeMapper.java
│   │   │           │   ├── QuestionMapper.java
│   │   │           │   ├── ExamMapper.java
│   │   │           │   ├── KnowledgeMasteryMapper.java
│   │   │           │   └── AIGradingMapper.java
│   │   │           │
│   │   │           ├── entity/                             # 实体类（数据库表映射）
│   │   │           │   ├── User.java
│   │   │           │   ├── Grade.java
│   │   │           │   ├── Question.java
│   │   │           │   ├── ExamPaper.java
│   │   │           │   ├── Exam.java
│   │   │           │   ├── KnowledgeMastery.java
│   │   │           │   └── AIGrading.java
│   │   │           │
│   │   │           ├── dto/                                # 数据传输对象
│   │   │           │   ├── request/                       # 请求DTO
│   │   │           │   │   ├── GradeCreateRequest.java
│   │   │           │   │   ├── QuestionCreateRequest.java
│   │   │           │   │   └── AIGradingRequest.java
│   │   │           │   └── response/                      # 响应DTO
│   │   │           │       ├── GradeResponse.java
│   │   │           │       ├── AnalysisResponse.java
│   │   │           │       └── AIGradingResponse.java
│   │   │           │
│   │   │           ├── vo/                                 # 视图对象（返回给前端）
│   │   │           │   ├── StudentGradeVO.java
│   │   │           │   ├── KnowledgeMasteryVO.java
│   │   │           │   └── WeakPointVO.java
│   │   │           │
│   │   │           ├── common/                             # 公共类
│   │   │           │   ├── Result.java                    # 统一返回结果
│   │   │           │   ├── PageResult.java                # 分页结果
│   │   │           │   ├── ErrorCode.java                 # 错误码枚举
│   │   │           │   └── Constants.java                 # 常量类
│   │   │           │
│   │   │           ├── exception/                          # 异常处理
│   │   │           │   ├── GlobalExceptionHandler.java    # 全局异常处理
│   │   │           │   ├── BusinessException.java         # 业务异常
│   │   │           │   └── ResourceNotFoundException.java
│   │   │           │
│   │   │           ├── util/                               # 工具类
│   │   │           │   ├── FileUtil.java                  # 文件工具
│   │   │           │   ├── PDFUtil.java                   # PDF解析
│   │   │           │   ├── WordUtil.java                  # Word解析
│   │   │           │   ├── ExcelUtil.java                 # Excel处理
│   │   │           │   └── DateUtil.java                  # 日期工具
│   │   │           │
│   │   │           ├── client/                             # 外部服务调用
│   │   │           │   ├── ProjectOneClient.java          # 调用子项目一
│   │   │           │   └── LLMClient.java                 # 调用LLM API
│   │   │           │
│   │   │           ├── interceptor/                        # 拦截器
│   │   │           │   └── AuthInterceptor.java           # 认证拦截器
│   │   │           │
│   │   │           └── validator/                          # 自定义验证器
│   │   │               └── KnowledgePointValidator.java
│   │   │
│   │   └── resources/
│   │       ├── application.yml                             # 主配置文件
│   │       ├── application-dev.yml                         # 开发环境配置
│   │       ├── application-prod.yml                        # 生产环境配置
│   │       ├── application-test.yml                        # 测试环境配置
│   │       │
│   │       ├── mapper/                                     # MyBatis XML文件
│   │       │   ├── GradeMapper.xml
│   │       │   ├── QuestionMapper.xml
│   │       │   └── AnalysisMapper.xml
│   │       │
│   │       ├── db/
│   │       │   └── migration/                              # 数据库迁移脚本
│   │       │       ├── V1.0__init_tables.sql
│   │       │       ├── V1.1__add_indexes.sql
│   │       │       └── V1.2__init_data.sql
│   │       │
│   │       ├── static/                                     # 静态资源
│   │       │   └── uploads/                               # 上传文件目录
│   │       │
│   │       ├── templates/                                  # 模板文件
│   │       │
│   │       └── logback-spring.xml                          # 日志配置
│   │
│   └── test/
│       └── java/
│           └── com/
│               └── assessment/
│                   ├── controller/                         # 控制器测试
│                   ├── service/                            # 服务测试
│                   └── mapper/                             # 数据访问测试
│
├── .gitignore                                              # Git忽略文件
├── pom.xml                                                 # Maven配置
├── README.md                                               # 项目说明
├── API.md                                                  # API文档
└── deploy/                                                 # 部署相关
    ├── Dockerfile
    └── docker-compose.yml
```