-- 为知识点错误统计功能生成测试数据
-- 包括题目、学生答题记录等

USE `education_platform_v1`;

-- 1. 插入测试题目（关联到计算机组成原理课程30的知识点）
INSERT INTO `question` (`title`, `question_type`, `difficulty`, `correct_answer`, `explanation`, `knowledge_point`, `course_id`, `chapter_id`, `created_by`, `create_time`, `is_deleted`) VALUES
('冯·诺依曼计算机的核心思想是什么？', 'single', 3, 'A', '存储程序是冯·诺依曼体系结构的核心思想', '390', 30, 94, 37, '2025-11-20 10:00:00', 0),
('下列哪个不是计算机的五大基本部件？', 'single', 2, 'D', '编译器是软件工具，不属于硬件部件', '390', 30, 94, 37, '2025-11-20 10:05:00', 0),
('总线按功能可分为哪几类？', 'multiple', 3, 'A,B,C', '总线分为数据总线、地址总线和控制总线', '393', 30, 94, 37, '2025-11-20 10:10:00', 0),
('Cache的作用是什么？', 'single', 3, 'B', 'Cache用于缓解CPU和主存之间的速度差异', '402', 30, 95, 37, '2025-11-20 10:15:00', 0),
('虚拟存储器的基本思想是什么？', 'single', 4, 'C', '虚拟存储器将外存作为主存的扩展', '405', 30, 95, 37, '2025-11-20 10:20:00', 0),
('补码加法运算的优点是什么？', 'single', 3, 'A', '补码加法可以将减法转换为加法运算', '414', 30, 96, 37, '2025-11-20 10:25:00', 0),
('IEEE 754标准中单精度浮点数的格式是什么？', 'single', 4, 'B', '单精度：1位符号+8位阶码+23位尾数', '415', 30, 96, 37, '2025-11-20 10:30:00', 0),
('立即寻址方式的操作数在哪里？', 'single', 2, 'A', '立即寻址方式的操作数直接包含在指令中', '425', 30, 97, 37, '2025-11-20 10:35:00', 0),
('RISC和CISC的主要区别是什么？', 'single', 4, 'C', 'RISC指令简单、数量少，CISC指令复杂、数量多', '427', 30, 97, 37, '2025-11-20 10:40:00', 0),
('微程序控制器的优点是什么？', 'single', 3, 'B', '微程序控制器易于修改和扩展', '440', 30, 98, 37, '2025-11-20 10:45:00', 0),
('中断响应的条件是什么？', 'multiple', 3, 'A,B,C', '中断响应需要满足中断请求、中断允许和指令执行完毕', '449', 30, 99, 37, '2025-11-20 10:50:00', 0),
('DMA传送方式的特点是什么？', 'single', 4, 'D', 'DMA方式下CPU不参与数据传送', '451', 30, 99, 37, '2025-11-20 10:55:00', 0),
('寄存器间接寻址的有效地址在哪里？', 'single', 3, 'C', '寄存器间接寻址的有效地址存放在寄存器中', '425', 30, 97, 37, '2025-11-20 11:00:00', 0),
('流水线的加速比如何计算？', 'single', 4, 'A', '加速比=不使用流水线时间/使用流水线时间', '438', 30, 98, 37, '2025-11-20 11:05:00', 0),
('主存与Cache的地址映射方式有哪些？', 'multiple', 4, 'A,B,C', '三种映射方式：直接映射、全相联映射、组相联映射', '402', 30, 95, 37, '2025-11-20 11:10:00', 0);

-- 2. 插入学生错误答题记录（模拟不同学生在不同时间的错误答题）
-- 学生22在计算机组成原理课程中的答题记录
INSERT INTO `student_answer` (`student_user_id`, `assignment_id`, `question_id`, `answer_content`, `is_correct`, `score`, `answer_time`, `is_deleted`) VALUES
-- 冯·诺依曼概念相关错误（知识点390）
(22, 36, 50, 'B', 0, 0, '2025-11-23 14:30:00', 0),
(22, 36, 51, 'A', 0, 0, '2025-11-23 14:32:00', 0),
(24, 36, 50, 'C', 0, 0, '2025-11-23 15:00:00', 0),
(24, 36, 51, 'B', 0, 0, '2025-11-23 15:02:00', 0),
(27, 36, 50, 'D', 0, 0, '2025-11-24 10:00:00', 0),
(28, 36, 50, 'B', 0, 0, '2025-11-24 11:00:00', 0),
(29, 36, 51, 'C', 0, 0, '2025-11-24 14:00:00', 0),
(33, 36, 50, 'C', 0, 0, '2025-11-25 09:00:00', 0),
(34, 36, 51, 'A', 0, 0, '2025-11-25 10:00:00', 0),

-- 总线相关错误（知识点393）
(22, 36, 52, 'A,B', 0, 0, '2025-11-23 14:35:00', 0),
(24, 36, 52, 'A,C', 0, 0, '2025-11-23 15:05:00', 0),
(27, 36, 52, 'B,C', 0, 0, '2025-11-24 10:05:00', 0),
(28, 36, 52, 'A,D', 0, 0, '2025-11-24 11:05:00', 0),
(29, 36, 52, 'B,D', 0, 0, '2025-11-24 14:05:00', 0),
(33, 36, 52, 'A,B', 0, 0, '2025-11-25 09:05:00', 0),
(34, 36, 52, 'C,D', 0, 0, '2025-11-25 10:05:00', 0),
(35, 36, 52, 'A', 0, 0, '2025-11-25 11:00:00', 0),

-- Cache相关错误（知识点402）
(22, 36, 53, 'A', 0, 0, '2025-11-23 14:40:00', 0),
(22, 36, 64, 'A,B', 0, 0, '2025-11-23 14:55:00', 0),
(24, 36, 53, 'C', 0, 0, '2025-11-23 15:10:00', 0),
(24, 36, 64, 'B,C', 0, 0, '2025-11-23 15:25:00', 0),
(27, 36, 53, 'D', 0, 0, '2025-11-24 10:10:00', 0),
(27, 36, 64, 'A,C', 0, 0, '2025-11-24 10:25:00', 0),
(28, 36, 53, 'A', 0, 0, '2025-11-24 11:10:00', 0),
(29, 36, 53, 'C', 0, 0, '2025-11-24 14:10:00', 0),
(33, 36, 64, 'B,D', 0, 0, '2025-11-25 09:20:00', 0),
(34, 36, 64, 'A,D', 0, 0, '2025-11-25 10:20:00', 0),

-- 虚拟存储器错误（知识点405）
(22, 36, 54, 'A', 0, 0, '2025-11-23 14:45:00', 0),
(24, 36, 54, 'B', 0, 0, '2025-11-23 15:15:00', 0),
(27, 36, 54, 'D', 0, 0, '2025-11-24 10:15:00', 0),
(28, 36, 54, 'A', 0, 0, '2025-11-24 11:15:00', 0),
(29, 36, 54, 'B', 0, 0, '2025-11-24 14:15:00', 0),
(33, 36, 54, 'D', 0, 0, '2025-11-25 09:10:00', 0),
(34, 36, 54, 'A', 0, 0, '2025-11-25 10:10:00', 0),

-- 补码运算错误（知识点414）
(22, 36, 55, 'B', 0, 0, '2025-11-23 14:48:00', 0),
(24, 36, 55, 'C', 0, 0, '2025-11-23 15:18:00', 0),
(27, 36, 55, 'D', 0, 0, '2025-11-24 10:18:00', 0),
(28, 36, 55, 'B', 0, 0, '2025-11-24 11:18:00', 0),
(29, 36, 55, 'C', 0, 0, '2025-11-24 14:18:00', 0),
(33, 36, 55, 'D', 0, 0, '2025-11-25 09:12:00', 0),

-- 浮点数表示错误（知识点415）
(22, 36, 56, 'A', 0, 0, '2025-11-23 14:50:00', 0),
(24, 36, 56, 'C', 0, 0, '2025-11-23 15:20:00', 0),
(27, 36, 56, 'D', 0, 0, '2025-11-24 10:20:00', 0),
(28, 36, 56, 'A', 0, 0, '2025-11-24 11:20:00', 0),
(29, 36, 56, 'C', 0, 0, '2025-11-24 14:20:00', 0),

-- 寻址方式错误（知识点425）
(22, 36, 57, 'B', 0, 0, '2025-11-23 14:52:00', 0),
(22, 36, 62, 'A', 0, 0, '2025-11-23 14:57:00', 0),
(24, 36, 57, 'C', 0, 0, '2025-11-23 15:22:00', 0),
(24, 36, 62, 'B', 0, 0, '2025-11-23 15:27:00', 0),
(27, 36, 57, 'D', 0, 0, '2025-11-24 10:22:00', 0),
(28, 36, 57, 'B', 0, 0, '2025-11-24 11:22:00', 0),
(29, 36, 62, 'D', 0, 0, '2025-11-24 14:22:00', 0),
(33, 36, 57, 'C', 0, 0, '2025-11-25 09:15:00', 0),

-- RISC/CISC错误（知识点427）
(22, 36, 58, 'A', 0, 0, '2025-11-23 14:53:00', 0),
(24, 36, 58, 'B', 0, 0, '2025-11-23 15:23:00', 0),
(27, 36, 58, 'D', 0, 0, '2025-11-24 10:23:00', 0),
(28, 36, 58, 'A', 0, 0, '2025-11-24 11:23:00', 0),

-- 流水线错误（知识点438）
(22, 36, 63, 'B', 0, 0, '2025-11-23 14:58:00', 0),
(24, 36, 63, 'C', 0, 0, '2025-11-23 15:28:00', 0),
(27, 36, 63, 'D', 0, 0, '2025-11-24 10:28:00', 0),

-- 微程序控制器错误（知识点440）
(22, 36, 59, 'A', 0, 0, '2025-11-23 14:54:00', 0),
(24, 36, 59, 'C', 0, 0, '2025-11-23 15:24:00', 0),
(27, 36, 59, 'D', 0, 0, '2025-11-24 10:24:00', 0),

-- 中断响应错误（知识点449）
(22, 36, 60, 'A,B', 0, 0, '2025-11-23 14:56:00', 0),
(24, 36, 60, 'B,C', 0, 0, '2025-11-23 15:26:00', 0),

-- DMA传送错误（知识点451）
(22, 36, 61, 'A', 0, 0, '2025-11-23 14:59:00', 0);

-- 3. 插入一些正确的答题记录（用于对比）
INSERT INTO `student_answer` (`student_user_id`, `assignment_id`, `question_id`, `answer_content`, `is_correct`, `score`, `answer_time`, `is_deleted`) VALUES
(22, 36, 59, 'B', 1, 5, '2025-11-26 10:00:00', 0),
(24, 36, 53, 'B', 1, 5, '2025-11-26 10:30:00', 0),
(27, 36, 55, 'A', 1, 5, '2025-11-26 11:00:00', 0),
(28, 36, 57, 'A', 1, 5, '2025-11-26 11:30:00', 0),
(29, 36, 58, 'C', 1, 5, '2025-11-26 14:00:00', 0);

-- 查询验证：查看各知识点的错误统计
SELECT 
    kp.id AS knowledge_point_id,
    kp.title AS knowledge_point_name,
    COUNT(*) AS error_count
FROM student_answer sa
INNER JOIN question q ON sa.question_id = q.id
INNER JOIN knowledge_point kp ON q.knowledge_point = kp.id
WHERE sa.is_correct = 0
AND sa.is_deleted = 0
AND q.is_deleted = 0
AND kp.is_deleted = 0
AND kp.course_id = 30
AND sa.answer_time >= DATE_SUB(NOW(), INTERVAL 30 DAY)
GROUP BY kp.id, kp.title
ORDER BY error_count DESC;
